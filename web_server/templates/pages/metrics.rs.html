{% extends "layouts/base.rs.html" %}
{% block title %}
  Session metrics
{% endblock %}

{% block head %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
        const metrics = JSON.parse("{{metrics}}".replace(/&quot;/g, '"'))

        const labels = Object.keys(metrics).sort();
        const dockerStartupData = labels.map(label => metrics[label].docker.avg_startup_time);
        const dockerRuntimeData = labels.map(label => metrics[label].docker.avg_runtime);
        const dockerTotalRuntimeData = labels.map(label => metrics[label].docker.avg_total_runtime);
        const wasmStartupData = labels.map(label => metrics[label].wasm.avg_startup_time);
        const wasmRuntimeData = labels.map(label => metrics[label].wasm.avg_runtime);
        const wasmTotalRuntimeData = labels.map(label => metrics[label].wasm.avg_total_runtime);


        const avgStartupCtx = document.getElementById('avgStartupChart');
        const avgRuntimeCtx = document.getElementById('avgRuntimeChart');
        const avgTotalTimeCtx = document.getElementById('avgTotalTimeChart');

        new Chart(avgStartupCtx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    label: 'Wasm',
                    data: wasmStartupData,
                    borderWidth: 1
                }, {
                    label: "Docker",
                    data: dockerStartupData,
                    borderWidth: 1
                }]
            },
        });
        new Chart(avgRuntimeCtx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    label: "Wasm",
                    data: wasmRuntimeData,
                    borderWidth: 1
                }, {
                    label: "Docker",
                    data: dockerStartupData,
                    borderWidth: 1
                }, ]
            },
        });
        new Chart(avgTotalTimeCtx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    label: "Wasm",
                    data: wasmTotalRuntimeData,
                    borderWidth: 1
                }, {
                    label: "Docker",
                    data: dockerTotalRuntimeData,
                    borderWidth: 1
                }, ]
            },
        });
    })
  </script>
{% endblock %}

{% block content %}
  <h1 class="text-4xl ml-4">Metric data</h1>
  <div class="grid grid-cols-2 gap-8 p-4">
    <div class="flex flex-col gap-2">
      <h2 class="text-2xl">Average startup time</h2>
      <div class="bg-white rounded-xl p-4">
        <canvas id="avgStartupChart" width="auto" height="200"></canvas>
      </div>
    </div>
    <div class="flex flex-col gap-2">
      <h2 class="text-2xl">Average runtime</h2>
      <div class="bg-white rounded-xl p-4">
        <canvas id="avgRuntimeChart" width="auto" height="200"></canvas>
      </div>
    </div>
    <div class="flex flex-col gap-2">
      <h2 class="text-2xl">Average total time</h2>
      <div class="bg-white rounded-xl p-4">
        <canvas id="avgTotalTimeChart" width="auto" height="200"></canvas>
      </div>
    </div>
  </div>
{% endblock %}
